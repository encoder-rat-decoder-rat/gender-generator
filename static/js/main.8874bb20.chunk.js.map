{"version":3,"sources":["GooeyShader.frag","GooeyFilter.js","downloadFrame.js","index.js"],"names":["GooeyFilter","threshold","Filter","defaulVertexSrc","fragment","_threshold","uniforms","uThreshold","value","this","svg","a","canvas","document","createElement","width","Number","getAttribute","height","ctx","getContext","image","Image","svgAsXML","XMLSerializer","serializeToString","Promise","resolve","onload","src","encodeURIComponent","drawImage","toBlob","blob","URL","createObjectURL","url","body","appendChild","setAttribute","click","remove","window","PIXI","settings","FILTER_RESOLUTION","FACE_LOCATIONS","Point","seed","URLSearchParams","location","search","get","seededRandom","seedrandom","app","Application","innerWidth","innerHeight","antialias","resizeTo","backgroundColor","sharedTicker","sharedLoader","start","Ticker","shared","view","blurFilter","filters","BlurFilter","blur","quality","gooeyFilter","dotFilter","DotFilter","colorReplace","MultiColorReplaceFilter","stage","faceContainer","Container","addChild","position","set","renderer","pivot","circle","Graphics","lineStyle","drawEllipse","scale","destination","currentParams","addOne","index","size","beginFill","drawCircle","endFill","setInterval","newParams","includes","downloadAsPNG","getElementById","i","setTimeout","bind","ticker","add","delta","children","forEach","child","x","y"],"mappings":"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","file":"static/js/main.8874bb20.chunk.js","sourcesContent":["export default \"// Based on Waterdrop shader from https://codepen.io/stefanweck/pen/Vbgeax\\nprecision highp float;\\n#define GLSLIFY 1\\nvarying vec2 vTextureCoord;\\nuniform sampler2D uSampler;\\nuniform float uThreshold;\\n\\nvoid main(void) {\\n    vec4 color = texture2D(uSampler, vTextureCoord);\\n    color.a = step(uThreshold, color.a);\\n    gl_FragColor = color;\\n}\";","import { Filter } from \"pixi.js\";\n\nimport fragment from \"./GooeyShader.frag\";\n\nclass GooeyFilter extends Filter {\n  constructor(threshold = 0.2) {\n    super(Filter.defaulVertexSrc, fragment);\n    this._threshold = threshold;\n    this.uniforms.uThreshold = this._threshold;\n  }\n\n  /**\n   * Sets the threshold for the amount of goooooo\n   *\n   * @member {Number}\n   * @default 0\n   */\n  set threshold(value) {\n    this._threshold = value;\n    this.uniforms.uThreshold = value;\n  }\n  get threshold() {\n    return this._threshold;\n  }\n}\n\nexport default GooeyFilter;\n","/**\n * Downloads the passed SVG node as a png.\n *\n * @param      {Node}   svg     The svg\n * @return     {Promise}  { description_of_the_return_value }\n */\nexport async function downloadAsPNG(svg) {\n  // First generate a canvas the size of the svg\n  const canvas = document.createElement(\"canvas\");\n  canvas.width = Number(svg.getAttribute(\"width\"));\n  canvas.height = Number(svg.getAttribute(\"height\"));\n  const ctx = canvas.getContext(\"2d\");\n\n  var image = new Image();\n  const svgAsXML = new XMLSerializer().serializeToString(svg);\n\n  await new Promise((resolve) => {\n    image.onload = resolve;\n    image.src = \"data:image/svg+xml,\" + encodeURIComponent(svgAsXML);\n  });\n\n  ctx.drawImage(image, 0, 0, canvas.width, canvas.height);\n\n  const url = await new Promise((resolve) => {\n    // toBlob(callback, mimeType, qualityArgument);\n    canvas.toBlob(function (blob) {\n      resolve(URL.createObjectURL(blob));\n    }, \"image/png\");\n  });\n\n  var a = document.createElement(\"a\");\n  document.body.appendChild(a); // This line makes it work in Firefox.\n  a.setAttribute(\"download\", \"image.jpg\");\n  a.setAttribute(\"href\", url);\n  a.setAttribute(\"target\", \"_blank\");\n  a.click();\n  // We don't need it anymore, remove it\n  a.remove();\n}\n","import \"./index.css\";\n\nimport {\n  Application,\n  Container,\n  Graphics,\n  filters,\n  Point,\n  Ticker,\n  settings,\n} from \"pixi.js\";\nimport * as PIXI from \"pixi.js\";\nimport { DotFilter } from \"@pixi/filter-dot\";\nimport { MultiColorReplaceFilter } from \"@pixi/filter-multi-color-replace\";\nimport seedrandom from \"seedrandom\";\n\nimport GooeyFilter from \"./GooeyFilter.js\";\n\nimport { downloadAsPNG } from \"./downloadFrame.js\";\n\nwindow.PIXI = PIXI;\nsettings.FILTER_RESOLUTION = 2;\n\nconst BG_COLOR = 0xadefd1;\nconst FG_COLOR = 0x00203f;\n\nconst FACE_LOCATIONS = [\n  // Hair\n  new Point(0, -350),\n  // Nose\n  new Point(0, 100),\n  // Lips\n  new Point(0, 250),\n  // Left Eye\n  new Point(-75, -100),\n  // Left Eyebrow\n  new Point(-75, -150),\n  // Left Ear\n  new Point(-300, 0),\n  // Right Eye\n  new Point(75, -100),\n  // Right Eyebrow\n  new Point(75, -150),\n  // Right Ear\n  new Point(300, 0),\n];\n\n///////////////////////////////////////////////////////////////////////////\n///////////////////////////////////////////////////////////////////////////\n/////////////////////////////// Reference ////////////////////////////////////\n///////////////////////////////////////////////////////////////////////////\n// http://bl.ocks.org/nbremer/0e98c72b043590769facc5e829ebf43f\n// http://bl.ocks.org/syntagmatic/6a921aed54be2a2bea5e56cf2157768b\n// https://www.visualcinnamon.com/2016/06/fun-data-visualizations-svg-gooey-effect\n\n///////////////////////////////////////////////////////////////////////////\n/////////////////////////////// Set-up ////////////////////////////////////\n///////////////////////////////////////////////////////////////////////////\n\n// Set our random seed based on the \"seed\" query parameter supplied\nconst queryParams = new URLSearchParams(window.location.search);\nconst seed = queryParams.get(\"seed\");\nconst seededRandom = seedrandom(seed);\n\n// Setup the pixi application\nconst app = new Application({\n  width: window.innerWidth,\n  height: window.innerHeight,\n  antialias: true,\n  resizeTo: window,\n  backgroundColor: BG_COLOR,\n  sharedTicker: true,\n  sharedLoader: true,\n});\nwindow.app = app;\napp.start();\nTicker.shared.start();\n// Add it to the body\ndocument.body.appendChild(app.view);\n\n// Add visual filters\nconst blurFilter = new filters.BlurFilter();\nblurFilter.blur = 20;\nblurFilter.quality = 10;\n\nconst gooeyFilter = new GooeyFilter();\n\nconst dotFilter = new DotFilter(1.05, 0);\nconst colorReplace = new MultiColorReplaceFilter(\n  [\n    [0xffffff, BG_COLOR],\n    [0x000000, FG_COLOR],\n  ],\n  0.1\n);\n\napp.stage.filters = [blurFilter, gooeyFilter, dotFilter, colorReplace];\n\n// Set a container for where all of the objects will be (so we can center and scale it on resize)\nconst faceContainer = new Container();\napp.stage.addChild(faceContainer);\nfaceContainer.position.set(app.renderer.width, app.renderer.height);\nfaceContainer.pivot.set(app.renderer.width / 2, app.renderer.height / 2);\n\n// Draw the oval behind the face\nconst circle = new Graphics()\n  .lineStyle(3, 0xcccccc)\n  .drawEllipse(0, 0, 300, 400);\ncircle.position.set(0, 0);\ncircle.scale.set(0, 0);\ncircle.destination = circle.position;\nfaceContainer.addChild(circle);\n\n// Set an interval loop to check if the ?frame query param is added to the url\nlet currentParams = null;\nconst checkFrame = () => {\n  const newParams = window.location.search;\n  if (currentParams !== newParams && newParams.includes(\"?frame\")) {\n    downloadAsPNG(document.getElementById(\"chartWrapper\"));\n  }\n  currentParams = newParams;\n};\nwindow.setInterval(checkFrame, 2000);\n\n/**\n * Add a random circle\n *\n * @param      {Number}  [size=seededRandom()*14+8]  The size\n */\nfunction addOne(index) {\n  const size = seededRandom() * 75 + 10;\n  const circle = new Graphics()\n    .beginFill(0xffffff * seededRandom())\n    .drawCircle(0, 0, size)\n    .endFill();\n  circle.position.set(0, 0);\n  circle.scale.set(0, 0);\n  circle.destination = FACE_LOCATIONS[index];\n  faceContainer.addChild(circle);\n}\n\n// Add a new blob every 2.5 seconds up to 9\nfor (let i = 0; i < 9; i += 1) {\n  window.setTimeout(addOne.bind(null, i), 5000 * i);\n}\n\n///////////////////////////////////////////////////////////////////////////\n/////////////////////////// Update Loop ///////////////////////////////////\n///////////////////////////////////////////////////////////////////////////\napp.ticker.add((delta) => {\n  faceContainer.children.forEach((child) => {\n    // Grow-in effect\n    child.scale.set(\n      child.scale.x + (1 - child.scale.x) * 0.1,\n      child.scale.y + (1 - child.scale.y) * 0.1\n    );\n\n    // Movement towards destination\n    child.position.set(\n      child.position.x + (child.destination.x - child.position.x) * 0.1,\n      child.position.y + (child.destination.y - child.position.y) * 0.1\n    );\n  });\n});\n"],"sourceRoot":""}